{"version":3,"sources":["../src/module.js"],"names":["_","kbn","MetricsPanelCtrl","Builder","Presenter","panelDefaults","radius","defaultColor","thresholds","format","decimals","mathScratchPad","mathDisplayValue","mathColorValue","StatusDotCtrl","$scope","$injector","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onRender","builder","presenter","addEditorTab","unitFormats","getUnitFormats","seriesList","render","dots","call","subitem","value","push","color","index","splice","dot","formatFunc","valueFormats","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACOA,O;;AACAC,S;;AACCC,sB,kBAAAA,gB;;AACAC,a,gBAAAA,O;;AACAC,e,kBAAAA,S;;;;;;;;;;;;;;;;;;;;;AAEFC,mB,GAAgB;AACpBC,gBAAQ,MADY;AAEpBC,sBAAc,oBAFM;AAGpBC,oBAAY,EAHQ;AAIpBC,gBAAQ,MAJY;AAKpBC,kBAAU,CALU;AAMpBC,wBAAgB,0CANI;AAOpBC,0BAAkB,WAPE;AAQpBC,wBAAgB;AARI,O;;oDAWTC,a;;;AACX,+BAAaC,MAAb,EAAqBC,SAArB,EAAgC;AAAA;;AAAA,oIACxBD,MADwB,EAChBC,SADgB;;AAE9BhB,YAAEiB,QAAF,CAAW,MAAKC,KAAhB,EAAuBb,aAAvB;;AAEA,gBAAKc,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKI,QAAL,CAAcF,IAAd,OAAzB;;AAEA,gBAAKG,OAAL,GAAe,IAAItB,OAAJ,CAAY,MAAKe,KAAjB,CAAf;AACA,gBAAKQ,SAAL,GAAiB,IAAItB,SAAJ,CAAc,MAAKc,KAAnB,CAAjB;AAT8B;AAU/B;;;;2CAEiB;AAChB,iBAAKS,YAAL,CAAkB,SAAlB,EAA6B,mDAA7B;AACA,iBAAKA,YAAL,CAAkB,QAAlB,EAA4B,mDAA5B;AACA,iBAAKC,WAAL,GAAmB3B,IAAI4B,cAAJ,EAAnB;AACD;;;yCAEeC,U,EAAY;AAC1B,iBAAKA,UAAL,GAAkBA,UAAlB;AACA,iBAAKC,MAAL;AACD;;;qCAEW;AACV,iBAAKC,IAAL,GAAY,KAAKP,OAAL,CAAaQ,IAAb,CAAkB,KAAKH,UAAvB,CAAZ;AACA,iBAAKJ,SAAL,CAAeO,IAAf,CAAoB,KAAKD,IAAzB;AACD;;;4CAEkBE,O,EAAS;AAC1B,iBAAKhB,KAAL,CAAWT,MAAX,GAAoByB,QAAQC,KAA5B;AACA,iBAAKJ,MAAL;AACD;;;iDAEuB;AACtB,iBAAKb,KAAL,CAAWV,UAAX,CAAsB4B,IAAtB,CAA2B,EAAED,OAAO,CAAT,EAAYE,OAAO,KAAKnB,KAAL,CAAWX,YAA9B,EAA3B;AACA,iBAAKwB,MAAL;AACD;;;kDAEwBO,K,EAAO;AAC9B,iBAAKpB,KAAL,CAAWV,UAAX,CAAsB+B,MAAtB,CAA6BD,KAA7B,EAAoC,CAApC;AACA,iBAAKP,MAAL;AACD;;;mCAESS,G,EAAK;AACb,mBAAO,EAAE,cAAcA,IAAIH,KAApB,EAA2B,SAAS,KAAKnB,KAAL,CAAWZ,MAA/C,EAAuD,UAAU,KAAKY,KAAL,CAAWZ,MAA5E,EAAP;AACD;;;iCAEO6B,K,EAAO;AACb,gBAAIM,aAAaxC,IAAIyC,YAAJ,CAAiB,KAAKxB,KAAL,CAAWT,MAA5B,CAAjB;AACA,mBAAOgC,WAAWN,KAAX,EAAkB,KAAKjB,KAAL,CAAWR,QAA7B,EAAuC,IAAvC,CAAP;AACD;;;;QAnDgCR,gB;;;;AAsDnCY,oBAAc6B,WAAd,GAA4B,aAA5B;;2BACS7B,a","file":"module.js","sourcesContent":["import './module.css!'\nimport _ from 'lodash'\nimport kbn from 'app/core/utils/kbn'\nimport {MetricsPanelCtrl} from 'app/plugins/sdk'\nimport {Builder} from './util/builder'\nimport {Presenter} from './util/presenter'\n\nconst panelDefaults = {\n  radius: '20px',\n  defaultColor: 'rgb(117, 117, 117)',\n  thresholds: [],\n  format: 'none',\n  decimals: 2,\n  mathScratchPad: 'data = size(data)[1] == 0 ? [NaN] : data',\n  mathDisplayValue: 'data[end]',\n  mathColorValue: 'data[end]'\n}\n\nexport class StatusDotCtrl extends MetricsPanelCtrl {\n  constructor ($scope, $injector) {\n    super($scope, $injector)\n    _.defaults(this.panel, panelDefaults)\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this))\n    this.events.on('data-received', this.onDataReceived.bind(this))\n    this.events.on('render', this.onRender.bind(this))\n\n    this.builder = new Builder(this.panel)\n    this.presenter = new Presenter(this.panel)\n  }\n\n  onInitEditMode () {\n    this.addEditorTab('Options', 'public/plugins/btplc-status-dot-panel/editor.html')\n    this.addEditorTab('Values', 'public/plugins/btplc-status-dot-panel/values.html')\n    this.unitFormats = kbn.getUnitFormats()\n  }\n\n  onDataReceived (seriesList) {\n    this.seriesList = seriesList\n    this.render()\n  }\n\n  onRender () {\n    this.dots = this.builder.call(this.seriesList)\n    this.presenter.call(this.dots)\n  }\n\n  onEditorSetFormat (subitem) {\n    this.panel.format = subitem.value\n    this.render()\n  }\n\n  onEditorAddThreshold () {\n    this.panel.thresholds.push({ value: 0, color: this.panel.defaultColor })\n    this.render()\n  }\n\n  onEditorRemoveThreshold (index) {\n    this.panel.thresholds.splice(index, 1)\n    this.render()\n  }\n\n  styleFor (dot) {\n    return { 'background': dot.color, 'width': this.panel.radius, 'height': this.panel.radius }\n  }\n\n  format (value) {\n    var formatFunc = kbn.valueFormats[this.panel.format]\n    return formatFunc(value, this.panel.decimals, null)\n  }\n}\n\nStatusDotCtrl.templateUrl = 'module.html'\nexport { StatusDotCtrl as PanelCtrl }\n"]}